# Socket版本PSRS算法测试指南

## 程序概述
本程序实现了基于Socket通信的Parallel Sorting by Regular Sampling (PSRS) 并行排序算法。程序分为服务器端和客户端两部分，需要在多个进程中运行。

## 编译和运行环境
- Windows系统
- C++编译器（支持C++11标准）
- Winsock2库（已在代码中链接）

## 已编译的程序
- `psrs_socket.exe`：Socket版本的PSRS程序

## 程序命令格式

### 服务器端命令
```
psrs_socket.exe server <客户端数量> <数据大小>
```

参数说明：
- `<客户端数量>`：需要启动的客户端进程数量（建议1-4个）
- `<数据大小>`：要排序的数据量（1000, 5000, 10000, 100000等）

### 客户端命令
```
psrs_socket.exe client <服务器IP> <客户端ID> <客户端总数>
```

参数说明：
- `<服务器IP>`：服务器的IP地址（本地测试使用127.0.0.1）
- `<客户端ID>`：客户端的唯一标识（从0开始）
- `<客户端总数>`：与服务器指定的客户端数量一致

## 测试步骤

### 1. 准备多个命令行窗口
- 打开1个命令行窗口作为服务器
- 打开N个命令行窗口作为客户端（N为客户端数量）

### 2. 启动服务器
在第一个命令行窗口中运行：
```
cd i:\Project
psrs_socket.exe server 2 10000
```
这将启动一个服务器，准备接收2个客户端连接，处理10000个数据元素。

### 3. 启动客户端
在其他命令行窗口中依次运行客户端命令：

客户端1：
```
cd i:\Project
psrs_socket.exe client 127.0.0.1 0 2
```

客户端2：
```
cd i:\Project
psrs_socket.exe client 127.0.0.1 1 2
```

注意：客户端ID必须从0开始，连续递增，总数必须与服务器指定的一致。

### 4. 观察测试结果
- 服务器会显示测试进度信息
- 完成后，服务器会输出：
  - 排序是否成功
  - 总排序时间

## 测试不同配置

### 测试不同数据量
```
# 测试1K数据
psrs_socket.exe server 2 1000

# 测试5K数据  
psrs_socket.exe server 2 5000

# 测试10K数据
psrs_socket.exe server 2 10000

# 测试100K数据
psrs_socket.exe server 2 100000
```

### 测试不同客户端数量
```
# 测试1个客户端
psrs_socket.exe server 1 10000

# 测试2个客户端
psrs_socket.exe server 2 10000

# 测试4个客户端
psrs_socket.exe server 4 10000
```

## 串行排序对比测试
为了计算加速比，需要单独测试串行排序的时间。可以使用以下方法：

1. 注释掉并行部分，只运行串行排序
2. 或者使用之前创建的`parallel_quicksort.exe`程序作为参考

## 测试注意事项

1. **客户端数量限制**：建议先从1-2个客户端开始测试，确保程序正常运行

2. **防火墙设置**：如果测试多台机器，需要确保防火墙允许Socket通信（端口12345）

3. **本地测试**：在同一台机器上测试时，使用127.0.0.1作为服务器IP

4. **数据量选择**：
   - 小数据量（1K-10K）：用于验证程序正确性
   - 大数据量（100K+）：用于测试性能和加速比

5. **客户端启动顺序**：服务器启动后，应尽快启动所有客户端，避免超时

## 示例测试会话

### 服务器输出
```
服务器启动，等待客户端连接...
客户端 0 连接成功
客户端 1 连接成功
生成数据完成，大小: 10000
发送数据到客户端...
接收客户端样本...
广播主元到客户端...
接收客户端重新划分的数据段...
归并排序...
排序结果正确!
总排序时间: 0.234 秒
```

### 客户端输出
```
连接到服务器成功
```

## 性能分析

根据测试结果，可以计算加速比：

```
加速比 = 串行排序时间 / 并行排序时间
```

理想情况下，客户端数量越多，加速比越高。但由于网络通信开销，实际加速比可能会低于客户端数量。

## 常见问题排查

1. **客户端无法连接到服务器**
   - 检查服务器IP地址是否正确
   - 检查端口12345是否被防火墙阻止
   - 确保服务器已先启动

2. **程序崩溃**
   - 检查客户端数量是否匹配
   - 检查数据大小是否过大导致内存不足
   - 查看命令行输出的错误信息

3. **排序结果错误**
   - 检查客户端ID是否正确设置
   - 确保所有客户端都成功启动

## 代码结构说明

- `server` 模式：负责数据生成、任务分配和结果合并
- `client` 模式：负责本地排序、采样和数据划分
- Socket通信：使用Winsock2库实现TCP/IP通信
- PSRS算法步骤：
  1. 数据划分
  2. 局部排序和采样
  3. 样本排序和主元选择
  4. 数据重新划分
  5. 归并排序和结果合并

## 扩展测试

如果有条件，可以在多台物理机器上测试：
1. 在一台机器上启动服务器
2. 在其他机器上启动客户端，使用服务器的实际IP地址
3. 测试更大的数据量和更多的客户端数量

这种测试可以更好地模拟真实的分布式计算环境，评估网络通信对性能的影响。